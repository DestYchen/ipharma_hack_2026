<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pharma Reference Chat</title>
    <link rel="stylesheet" href="/ui/styles.css?v=20260225" />
  </head>
  <body>
    <div class="app-shell drawer-open" id="appShell">
      <div class="ambient-layer" aria-hidden="true">
        <div class="ambient-grid"></div>
        <div class="pill pill-1"></div>
        <div class="pill pill-2"></div>
        <div class="pill pill-3"></div>
        <div class="pill pill-4"></div>
        <div class="pill pill-5"></div>
      </div>

      <aside class="history-drawer" id="historyDrawer" aria-label="История запросов">
        <div class="drawer-header">
          <button class="icon-btn" id="drawerCloseBtn" type="button" aria-label="Закрыть историю">
            ✕
          </button>
          <div class="brand-block">
            <div class="brand-title">Pharma Flow</div>
            <div class="brand-subtitle">Reference + Router</div>
          </div>
          <button class="ghost-btn" id="newChatBtn" type="button">Новый</button>
        </div>

        <div class="history-list" id="historyList" role="list"></div>
      </aside>

      <button class="drawer-backdrop" id="drawerBackdrop" type="button" aria-label="Закрыть историю"></button>

      <main class="chat-stage" id="chatStage">
        <header class="top-bar">
          <div class="top-left">
            <button class="icon-btn" id="drawerToggleBtn" type="button" aria-label="Открыть историю">
              ☰
            </button>
            <div class="top-title-wrap">
              <div class="top-title">Pharma Reference Chat</div>
              <div class="top-subtitle">Локальный поиск референта + запуск `test_router.py`</div>
            </div>
          </div>
          <div class="top-right"></div>
        </header>

        <section class="timeline" id="timeline" aria-live="polite" aria-label="Диалог"></section>

        <section class="composer-shell" id="composerShell">
          <form class="composer-panel" id="searchForm">
            <div class="composer-primary">
              <label class="field primary-field">
                <span class="field-label">Название / МНН</span>
                <div class="primary-input-row">
                  <input id="mnnInput" name="mnn" type="text" placeholder="Дарунавир" autocomplete="off" required />
                  <button class="primary-btn" id="searchBtn" type="submit">
                    <span class="btn-label">Найти референт</span>
                    <span class="btn-loader" aria-hidden="true"></span>
                  </button>
                </div>
              </label>
            </div>

            <div class="composer-grid">
              <label class="field">
                <span class="field-label">Пути введения</span>
                <input id="routesInput" name="routes" type="text" placeholder="перорально / в/в и в/м" autocomplete="off" required />
              </label>

              <label class="field">
                <span class="field-label">Базовая форма</span>
                <input id="baseFormInput" name="base_form" type="text" placeholder="таблетки" autocomplete="off" required />
              </label>

              <label class="field">
                <span class="field-label">Тип высвобождения</span>
                <select id="releaseTypeInput" name="release_type" required>
                  <option value="обычное">обычное</option>
                  <option value="пролонгированное">пролонгированное</option>
                  <option value="модифицированное">модифицированное</option>
                  <option value="кишечнорастворимое">кишечнорастворимое</option>
                </select>
              </label>

              <label class="field">
                <span class="field-label">Дозировка</span>
                <input id="dosageInput" name="dosage" type="text" placeholder="600 мг" autocomplete="off" required />
              </label>
            </div>

            <div class="composer-actions">
              <label class="switch">
                <input id="autorunCheckbox" type="checkbox" checked />
                <span>Сразу запускать `test_router.py` после выбора</span>
              </label>

              <button class="ghost-btn" id="resetFormBtn" type="button">Сбросить</button>
            </div>

            <details class="advanced-box">
              <summary>Дополнительно</summary>
              <div class="advanced-grid">
                <label class="field">
                  <span class="field-label">URL локального API</span>
                  <input id="apiUrlInput" type="url" placeholder="http://127.0.0.1:8000" />
                </label>
                <label class="field">
                  <span class="field-label">Путь к XLS (опционально)</span>
                  <input id="xlsPathInput" type="text" placeholder="Авто (первый .xls в папке сервера)" />
                </label>
                <label class="field">
                  <span class="field-label">Путь JSON выбора (опционально)</span>
                  <input id="saveJsonPathInput" type="text" placeholder="Например: selected_reference.json" />
                </label>
                <label class="field">
                  <span class="field-label">Путь ответа test_router (опционально)</span>
                  <input id="saveRouterOutputPathInput" type="text" placeholder="Например: router_output.txt" />
                </label>
              </div>
            </details>
          </form>
        </section>
      </main>
    </div>


    <template id="messageTemplate">
      <article class="message">
        <div class="message-avatar"></div>
        <div class="message-card">
          <div class="message-meta"></div>
          <div class="message-body"></div>
        </div>
      </article>
    </template>

    <script src="/ui/app.js?v=20260225"></script>
  </body>
  </html>
